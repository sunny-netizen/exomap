<!DOCTYPE html>
<html lang="en">
<head>
    <!--
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script src="https://api.mapbox.com/mapbox-gl-js/v2.0.1/mapbox-gl.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.0.1/mapbox-gl.css" rel="stylesheet" />

    <script src="https://api.mapbox.com/mapbox-gl-js/v2.0.1/mapbox-gl.js"></script>

    <script charset="utf-8" src="https://d3js.org/d3.v4.min.js"></script>

    <title>Document</title>

    <style>
        body { margin: 0; padding: 0; }
          
        #title {
            position: absolute;
            background-color: #fff;
            box-shadow:0 1px 2px rgba(0, 0, 0, 0.20);
            border-radius: 3px;
            padding: 15px;
            margin-top: 15px;
            margin-left: 15px;
        }
    
        #title h2 {
            line-height: 24px;
            margin: 0;
        }
    
        #title p.credit {
           margin: 10px 0 0 0;
           padding: 0;
        }
        
        #map { position: absolute; top: 0; bottom: 0; width: 100%; };
        
    </style>
</head>
<body>
    <div id="map"></div>
    <div id="title">
        <h2>Exoplanet Map</h2>
         <p class="credit">Data: <a href="https://exoplanetarchive.ipac.caltech.edu/">NASA Exoplanet Archive API</a>.</p>
    </div>   


<script>
    /* 
    // https://medium.com/@dtkatz/3-ways-to-fix-the-cors-error-and-how-access-control-allow-origin-works-d97d55946d9 
    // https://github.com/Rob--W/cors-anywhere/#documentation
    (function() {
        var cors_api_host = 'cors-anywhere.herokuapp.com';
        var cors_api_url = 'https://' + cors_api_host + '/';
        var slice = [].slice;
        var origin = window.location.protocol + '//' + window.location.host;
        var open = XMLHttpRequest.prototype.open;
        XMLHttpRequest.prototype.open = function() {
            var args = slice.call(arguments);
            var targetOrigin = /^https?:\/\/([^\/]+)/i.exec(args[1]);
            if (targetOrigin && targetOrigin[0].toLowerCase() !== origin &&
                targetOrigin[1] !== cors_api_host) {
                args[1] = cors_api_url + args[1];
            }
            return open.apply(this, args);
        };
    })(); */

    /*
     // https://stackoverflow.com/questions/55980618/how-to-fetch-data-from-back-end 
    fetch(url, { method: 'GET' }, 
        function (res) {
        return res.json()
    })
    //console.log(JSON.stringify(myJson))
    */

    // https://stackoverflow.com/questions/35553500/xmlhttprequest-cannot-load-xxx-no-access-control-allow-origin-header
    //Access-Control-Allow-Origin: *

    mapboxgl.accessToken = 'pk.eyJ1IjoieXVuemhhbzIxIiwiYSI6ImNreWxnbDR2ejF5MjIyd3AwNXA1cDl1eGsifQ.64sJi7Q8xOekHT7A6IljEQ';

        // Load a new map in the 'map' HTML div
        var map = new mapboxgl.Map({
            container: 'map', // container id
            style: 'mapbox://styles/mapbox/dark-v10', // Using the standard Mapbox Dark style
            center: [-0.1, 51.5], // starting position [lng, lat]
            zoom: 12 // starting zoom
        });

    // https://wilsjame.github.io/how-to-nasa/#:~:text=Head%20over%20to%20api.NASA,Astronomy%20Picture%20Of%20The%20Day
    var proxy = "https://cors-anywhere.herokuapp.com/"
    var proxy2 = "http://cors.io/?"
    var url = "https://exoplanetarchive.ipac.caltech.edu/TAP/sync?query=select+*+from+pscomppars&format=json"
    var apikey = "50jiaKZWShuLw5q3QlC5vucCIWnxh4waOhFs3zHE"
    var apod = "https://api.nasa.gov/planetary/apod"
    

   

    map.on('load', function(data) { 
        
        
        // Load JSON data from the NASA API
        //d3.json(url + "?api_key=" + apikey, 
        //d3.csv("PS_2022.03.03_15.38.42_.csv",
        d3.json(proxy2 + url,
            function(ExoData) {
                console.log(ExoData);
            
        // https://stackoverflow.com/questions/17090642/d3-ignore-certain-row-in-csv
                //var dirtyCSV = Data.responseText;
                //var cleanCSV = dirtyCSV.split('\n').slice(96).join('\n');
                //var parsedCSV = d3.csv.parse(cleanCSV);
                //console.log(parsedCSV);
                //console.log(ExoData[1]); 

                
                // Create new GeoJSON  
                var myGeojson = {};
                myGeojson.type = 'FeatureCollection'; //Specify type is feature collection
                myGeojson.features = []; //Create features array
    
                    var PlanetName = ExoData['pl_name'];
                    var ra_long = ExoData['ra']
                    //var temp = ra_long[ra_long[:] > 180]
                    //    if (ExoData['ra'] > 180) ExoData['ra'] = ExoData['ra'] - 360 }
                    var dec_lat = ExoData['dec']
                    // d3.select(ra_long)

                    
                    //var PropFull = NbBikes/(NbBikes+NbEmptyDocks);

                    
                    /*
                        var newFeature = { //Create each docking station feature as JSON object
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [ ExoData['dec'], ExoData['ra'] ]
                            },
                            "properties": {
                                "PlanetName": PlanetName
                            }
                        }
                        myGeojson.features.push(newFeature); //Add the new feature to the features array 
            
                
            console.log(myGeojson);

            
            map.addSource('points', { //Add the geojson to the map.
                'type': 'geojson',
                'data': myGeojson
                });

            

            map.addLayer({
                id: 'BikeStations',
                type: 'circle',
                source: 'points', 
                        'layout': {'visibility': 'visible'},
                paint: {
                    'circle-color':{
                        property: 'PropFull',
                        stops: [
                            [0, "#00f"],
                            [1, "#f00"],
                        ]
                    },
                    'circle-opacity': 0.6,
                    'circle-stroke-width': 0.1,
                    'circle-stroke-color': '#999',
                    'circle-stroke-opacity': 1,
                    'circle-radius': {
                        property: 'NbTotalDocks',
                        stops: [
                            [{zoom: 9, value: 0}, 0.1],
                            [{zoom: 9, value: 40}, 2],
                            [{zoom: 12, value: 0}, 3],
                            [{zoom: 12, value: 40}, 15],
                            [{zoom: 16, value: 0}, 4],
                            [{zoom: 16, value: 40}, 60],
                            ]
                    }
                }
            }) */   
            }
        )
    })

    
</script>
</body>
</html>